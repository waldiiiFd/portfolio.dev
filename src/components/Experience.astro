---
import { getCollection } from "astro:content";
import { getLangFromUrl, useTranslations } from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Get all experience items for the current language
const allExperience = await getCollection("experience", ({ data }) => {
  return data.lang === lang;
});

// Sort experience items by order
const sortedExperience = allExperience.sort(
  (a, b) => a.data.order - b.data.order
);
---

<section id="experience" class="bg-gray t-pad100 b-pad80">
  <div class="container">
    <div class="row">
      <div class="col-md-12 text-center b-pad60">
        <h2 class="heading">{t("experience.title")}</h2>
        <p class="h-sub">
          {t("experience.subtitle")}
        </p>
      </div>
    </div>

    <div class="row">
      {sortedExperience.map((exp) => (
        <div class="col-md-12 b-mgr40">
          <div
            class="experience-card bg-white"
            style={`
              padding: 35px;
              border-radius: 8px;
              border-left: 4px solid var(--main-color);
              position: relative;
              box-shadow: 0 2px 10px rgba(0,0,0,0.05);
              transition: transform 0.3s ease, box-shadow 0.3s ease;
            `}
            onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 20px rgba(0,0,0,0.1)'"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 10px rgba(0,0,0,0.05)'"
          >
            {exp.data.current && (
              <div
                style={`
                  position: absolute;
                  top: 35px;
                  right: 35px;
                  background: #3b82f6;
                  color: white;
                  padding: 8px 20px;
                  border-radius: 20px;
                  font-size: 14px;
                  font-weight: 600;
                  z-index: 10;
                  text-transform: uppercase;
                  letter-spacing: 0.5px;
                `}
              >
                 {t("experience.current")}
              </div>
            )}

            <div class="content">
              <h3 style="color: var(--main-color); margin-bottom: 5px;">
                {exp.data.title}
              </h3>

              <p
                class="text-muted"
                style="margin: 8px 0; font-size: 16px; font-weight: 600;"
              >
                <i
                  class={exp.data.icon}
                  style="margin-right: 8px;"
                ></i>
                {exp.data.company}
              </p>

              <p class="text-muted" style="margin: 5px 0 20px 0;">
                <i class="icon-picons-calendar" style="margin-right: 8px;"></i>
                {exp.data.period}
              </p>

              <p style="line-height: 1.8; color: #555;">
                {exp.data.description}
              </p>

              {exp.data.technologies && exp.data.technologies.length > 0 && (
                <div style="margin-top: 20px; margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 8px;">
                  {exp.data.technologies.map((tech) => (
                    <span class="label label-info" style="display: inline-block;">
                      {tech}
                    </span>
                  ))}
                </div>
              )}
            </div>
          </div>
        </div>
      ))}
    </div>

    <div class="row">
      <div class="col-md-12 text-center t-mgr40">
        <!-- Add a "View More" button if needed -->
        <!-- <a href="#" class="btn btn-white-brd large">
          View Full Resume
          <i class="arrow_right">&rarr;</i>
        </a> -->
      </div>
    </div>
  </div>
</section>